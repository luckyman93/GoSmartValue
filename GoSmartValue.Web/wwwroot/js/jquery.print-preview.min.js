/*!
 * jQuery Print Previw Plugin v1.0.1
 *
 * Copyright 2011, Tim Connell
 * Licensed under the GPL Version 2 license
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * Date: Wed Jan 25 00:00:00 2012 -000
 */
(function(n){n.fn.printPreview=function(){return this.each(function(){n(this).bind("click",function(t){t.preventDefault();n("#print-modal").length||n.printPreview.loadPrintPreview()})}),this};var t,u,i,r;n.printPreview={loadPrintPreview:function(){var u,f,t,e,o,s;for(i=n('<div id="print-modal"><\/div>'),r=n('<div id="print-modal-controls"><a href="#" class="print" title="Print page">Print page<\/a><a href="#" class="close" title="Close print preview">Close<\/a>').hide(),u=n('<iframe id="print-modal-content" scrolling="no" border="0" frameborder="0" name="print-frame" />'),i.hide().append(r).append(u).appendTo("body"),f=0;f<window.frames.length;f++)if(window.frames[f].name=="print-frame"){t=window.frames[f].document;break}t.open();t.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><title>'+document.title+"<\/title><\/head><body><\/body><\/html>");t.close();e=n("head link[media*=print], head link[media=all]").clone();o=n("body > *:not(#print-modal):not(script)").clone();e.each(function(){n(this).attr("media","all")});n.browser.msie||n.browser.version<7?(n("body > *:not(#print-modal):not(script)").clone().each(function(){n("body",t).append(this.outerHTML)}),n("head link[media*=print], head link[media=all]").each(function(){n("head",t).append(n(this).clone().attr("media","all")[0].outerHTML)})):(n("head",t).append(e),n("body",t).append(o));n("a",t).bind("click.printPreview",function(n){n.preventDefault()});n("head").append('<style type="text/css">@media print {/* -- Print Preview --*/#print-modal-mask,#print-modal {display: none !important;}}<\/style>');n.printPreview.loadMask();n("body").css({overflowY:"hidden",height:"100%"});n("img",t).load(function(){u.height(n("body",u.contents())[0].scrollHeight)});starting_position=n(window).height()+n(window).scrollTop();s={top:starting_position,height:"100%",overflowY:"auto",zIndex:1e4,display:"block"};i.css(s).animate({top:n(window).scrollTop()},400,"linear",function(){r.fadeIn("slow").focus()});u.height(n("body",u.contents())[0].scrollHeight);n("a",r).bind("click",function(t){t.preventDefault();n(this).hasClass("print")?window.print():n.printPreview.distroyPrintPreview()})},distroyPrintPreview:function(){r.fadeOut(100);i.animate({top:n(window).scrollTop()-n(window).height(),opacity:1},400,"linear",function(){i.remove();n("body").css({overflowY:"auto",height:"auto"})});t.fadeOut("slow",function(){t.remove()});n(document).unbind("keydown.printPreview.mask");t.unbind("click.printPreview.mask");n(window).unbind("resize.printPreview.mask")},loadMask:function(){u=n.printPreview.sizeUpMask();t=n('<div id="print-modal-mask" />').appendTo(n("body"));t.css({position:"absolute",top:0,left:0,width:u[0],height:u[1],display:"none",opacity:0,zIndex:9999,backgroundColor:"#000"});t.css({display:"block"}).fadeTo("400",.75);n(window).bind("resize..printPreview.mask",function(){n.printPreview.updateMaskSize()});t.bind("click.printPreview.mask",function(){n.printPreview.distroyPrintPreview()});n(document).bind("keydown.printPreview.mask",function(t){t.keyCode==27&&n.printPreview.distroyPrintPreview()})},sizeUpMask:function(){if(n.browser.msie){var t=n(document).height(),i=n(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t-i<20?i:t]}return[n(document).width(),n(document).height()]},updateMaskSize:function(){var i=n.printPreview.sizeUpMask();t.css({width:i[0],height:i[1]})}}})(jQuery);